##   一致性hash

FAQ: 
------------------------
-   为什么叫一致性hash
-   解决什么问题
-   如何实现
-   一致性hash与 mongodb、zookeeper中的HA机制比较


### 为什么叫一致性hash
一致性哈希的典型应用场景，也就是分布式缓存。
分布式缓存就是 将缓存存储到多台 服务器(redis)上， 查找使用hash算法进行定位数据，以便快速找到数
据，这就是为什么需要hash。
下面说说hash的算法实现， 一般hash算法就是对 长度 取模， 这里一致性hash 是对 2^32 取模， 范围为
`0  ~ (2^32)-1` , 这样就构成了一个环。
然后谈 一致性hash的体现， 当服务器数量发现变化( 添加或者减少 )时，对其数据 计算出的hash值就会变化，从而无法保证能找到的数据。

```
考虑到分布式系统每个节点都有可能失效，并且新的节点很可能动态的增加进来，如何保证当系统的节点数
目发生变化时仍然能够对外提供良好的服务，这是值得考虑的，尤其实在设计分布式缓存系统时，如果某台
服务器失效，对于整个系统来说如果不采用合适的算法来保证一致性，那么缓存于系统中的所有数据都可能
会失效（即由于系统节点数目变少，客户端在请求某一对象时需要重新计算其hash值（通常与系统中的节点
数目有关），由于hash值已经改变，所以很可能找不到保存该对象的服务器节点）
```
### 分布式一致性 与 一致性hash区别
分布式一致性 英文叫做 distributed consensus. 一致性hash叫做 consistent hashing.
完全是两回事情， 不能混为一谈，一致性hash保证不了任何的分布式一致性， 只是一种降低cachemiss的
载均衡而已。

###  解决什么问题

解决了分布式缓存中数据的一致性问题， 同时保证了缓存的容错性与可扩展性。

### 如何实现
一致性哈希将整个哈希值空间组织成一个虚拟的圆环，如假设某哈希函数H的值空间为0-2^32-1
（即哈希值是一个32位无符号整形），整个哈希空间环如下：
![hash](https://pic2.zhimg.com/v2-1314d64ed37063fdee4d83ec283a6e85_b.jpg)

**步骤**

-   首先求出memcached服务器（节点）的哈希值(对2^32求模)，并将其配置到0～232的圆（continuum）上。
-   然后采用同样的方法求出存储数据的键的哈希值，并映射到相同的圆上。
-   然后从数据映射到的位置开始顺时针查找，将数据保存到找到的第一个服务器上。


### 一致性hash与 mongodb、zookeeper中的HA机制比较
mongodb、zookeeper的HA 机制属于 分布式一致性问题， 就是将数据同步成一样的；
一致性hash是 将数据定位到一个环中，以便解决分布式cache 中服务器数量变量带来的数据不一致问题。
