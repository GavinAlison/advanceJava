## 同步、异步、阻塞、非阻塞


### 故事：老王烧开水。
```
出场人物：老王，水壶两把（普通水壶，简称水壶；会响的水壶，简称响水壶）。

老王想了想，有好几种等待方式

1.老王用水壶煮水，并且站在那里，不管水开没开，每隔一定时间看看水开了没。－同步阻塞

老王想了想，这种方法不够聪明。

2.老王还是用水壶煮水，不再傻傻的站在那里看水开，跑去寝室上网，但是还是会每隔一段时间过来看看水开了没有，水没有开就走人。－同步非阻塞

老王想了想，现在的方法聪明了些，但是还是不够好。

3.老王这次使用高大上的响水壶来煮水，站在那里，但是不会再每隔一段时间去看水开，而是等水开了，水壶会自动的通知他。－异步阻塞

老王想了想，不会呀，既然水壶可以通知我，那我为什么还要傻傻的站在那里等呢，嗯，得换个方法。

4.老王还是使用响水壶煮水，跑到客厅上网去，等着响水壶自己把水煮熟了以后通知他。－异步非阻塞

老王豁然，这下感觉轻松了很多。
```
### 同步和异步

同步就是烧开水，需要自己去轮询（每隔一段时间去看看水开了没），异步就是水开了，
然后水壶会通知你水已经开了，你可以回来处理这些开水了。
同步和异步是相对于操作结果来说，会不会等待结果返回。

### 阻塞和非阻塞

阻塞就是说在煮水的过程中，你不可以去干其他的事情，非阻塞就是在同样的情况下，
可以同时去干其他的事情。阻塞和非阻塞是相对于线程是否被阻塞。

其实，这两者存在本质的区别，它们的修饰对象是不同的。
阻塞和非阻塞是指进程访问的数据如果尚未就绪，进程是否需要等待，
简单说这相当于函数内部的实现区别，也就是未就绪时是直接返回还是等待就绪。

而同步和异步是指访问数据的机制,同步一般指主动请求并等待I/O操作完毕的方式,
当数据就绪后在读写的时候必须阻塞,异步则指主动请求数据后便可以继续处理其它任务,
随后等待I/O,操作完毕的通知,这可以使进程在数据读写时也不阻塞。


### 网络IO的模型大致包括下面几种
-   同步模型（synchronous IO）
    -   阻塞IO（bloking IO）  
    -   非阻塞IO（non-blocking IO） NIO
    -   多路复用IO（multiplexing IO） 
    -   信号驱动式IO（signal-driven IO）
-   异步IO（asynchronous IO）
    -   异步IO

网络IO的本质是socket的读取，socket在linux系统被抽象为流，IO可以理解为对流的操作。
对于一次IO访问，数据会先被拷贝到操作系统内核的缓冲区中，然后才会从操作系统内核的缓冲区
拷贝到应用程序的地址空间，所以一般会经历两个阶段：

-   等待所有数据都准备好或者一直在等待数据，有数据的时候将数据拷贝到系统内核；
-   将内核缓存中数据拷贝到用户进程中；

对于socket流而言：

-   等待网络上的数据分组到达，然后被复制到内核的某个缓冲区；
-   把数据从内核缓冲区复制到应用进程缓冲区中；

阻塞IO --> 就是线程等待IO操作, 应用：阻塞socket、Java BIO；

非阻塞IO（non-blocking IO） NIO --->  就是线程不用等待IO操作，但是需要线程不断循环判断IO是否准备好了，简称轮询。
准备好该线程可以进行其他操作。 应用：socket是非阻塞的方式（设置为NONBLOCK）

IO多路复用 ---> 多个的IO可以注册到一个复用器（select）上，然后用一个进程调用该select，
 select会监听所有注册进来的IO；
应用：select、poll、epoll三种方案, nginx, Java NIO;

信号驱动IO模型 ---> 当进程发起一个IO操作，会向内核注册一个信号处理函数，然后进程返回不阻塞；
当内核数据就绪时会发送一个信号给进程，进程便在信号处理函数中调用IO读取数据。
简单说，就是一个进程发起IO操作，等待一个回调机制返回信号量(阻塞)，有了这个信号量就可以进行IO操作了，

异步IO模型 --->  当进程发起一个IO操作，进程返回（不阻塞），但也不能返回结果；
内核把整个IO处理完后，会通知进程结果。如果IO操作成功则进程直接获取到数据。

应用：JAVA7 AIO、高性能服务器应用

## IO图比较
![IO图比较](https://pic2.zhimg.com/v2-fba5dcdad48d31bd560fd3634acaa551_b.jpg)
 
## BIO、NIO、AIO的概述
传统的 java.io包，它基于流模型实现，提供了我们最熟知的一些 IO 功能，比如 File 抽象、输入输出流等。交互方式是同步、阻塞的方式，也就是说，在读取输入流或者写入输出流时，
在读、写动作完成之前，线程会一直阻塞在那里，它们之间的调用是可靠的线性顺序。

java.io包的好处是代码比较简单、直观，缺点则是 IO 效率和扩展性存在局限性，容易成为应用性能的瓶颈。

很多时候，人们也把 java.net下面提供的部分网络 API，比如 Socket、ServerSocket、
HttpURLConnection 也归类到同步阻塞 IO 类库，因为网络通信同样是 IO 行为。

第二，在 Java 1.4 中引入了 NIO 框架（java.nio 包），提供了 Channel、Selector、Buffer 
等新的抽象，可以构建多路复用的、同步非阻塞 IO 程序，同时提供了更接近操作系统底层的高性能数据操作方式。

第三，在 Java 7 中，NIO 有了进一步的改进，也就是 NIO 2，引入了异步非阻塞 IO 方式，
也有很多人叫它 AIO（Asynchronous IO）。异步 IO 操作基于事件和回调机制，可以简单理解为，
应用操作直接返回，而不会阻塞在那里，当后台处理完成，操作系统会通知相应线程进行后续工作。

### IO流图
![IO流图](https://images2018.cnblogs.com/blog/1302135/201808/1302135-20180816173529402-760533731.png)

### BIO 通信模型图
![BIO 通信模型图](http://blog.anxpp.com/usr/uploads/2016/05/549520916.png)

### 伪异步I/O编程
![伪异步I/O编程](http://blog.anxpp.com/usr/uploads/2016/05/614169023.png)

### NIO 编程
![NIO 编程](http://dl2.iteye.com/upload/attachment/0095/0309/21c0d590-0547-386e-ab24-ce1cf7bf3283.png)


链接：
> [IO读写——同步、异步与阻塞、非阻塞之间的区别](https://blog.csdn.net/caisongcheng_good/article/details/80241617)
> [阻塞和非阻塞，同步和异步](https://www.cnblogs.com/George1994/p/6702084.html)
> [5种IO模型、阻塞IO和非阻塞IO、同步IO和异步IO](https://www.zhihu.com/search?type=content&q=同步异步阻塞非阻塞及五种io)
> [java IO、NIO、AIO详解](https://www.cnblogs.com/sxkgeek/p/9488703.html)
> [java aio和nio的区别](https://blog.csdn.net/luzhensmart/article/details/82230076)

